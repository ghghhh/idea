<%@ page language="java" import="java.util.*" pageEncoding="UTF-8"%>
<%
String path = request.getContextPath();
String basePath = request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+path+"/";
%>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <base href="<%=basePath%>">
    
    <title>My JSP 'user.jsp' starting page</title>
        <%@ include file="/js.jsp"%>
    
	<meta http-equiv="pragma" content="no-cache">
	<meta http-equiv="cache-control" content="no-cache">
	<meta http-equiv="expires" content="0">    
	<meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
	<meta http-equiv="description" content="This is my page">
  </head>
  <body>
  <div align="center" style="margin: 10px">
  <select id="cc" class="easyui-combobox" style="width:100px;">  
    <option value="pid">用户编号</option>   
    <option value="name">用户名</option>      
  </select> 
  <input id="tb" class="easyui-textbox"/>
  <a id="search" class="easyui-linkbutton">搜索</a>
  </div>
  <table id="user" style="height:550px"></table> 
  <div id="addUser" class="easyui-window" style="width:300px;height:400px" closed=true>
         <form id="userInfo" method="post">
         <input class="easyui-textbox" type="hidden" name="pid"/>
         <table cellpadding="5">
            <tr>
              <td>用户名</td>
              <td><input class="easyui-textbox" type="text" name="userName"/></td>
            </tr>
            <tr>
              <td>密码</td>
              <td><input class="easyui-textbox" type="text" name="userPassword"/></td>
            </tr>
            <tr>
              <td>信息</td>
              <td><input class="easyui-textbox" type="text" name="info"/></td>
            </tr>
         </table>
         </form>
         <div style="text-align:center;padding:5px">
					<a href="javascript:void(0)" class="easyui-linkbutton" onclick="submitForm()">确定</a> 
					<a href="javascript:void(0)" class="easyui-linkbutton" onclick="clearForm()">取消</a>
		 </div>
  </div>   
  </body>
  <script type="text/javascript">
  $("#user").datagrid({
    url:'user/userList.do',
    method:'GET',
    columns:[[
       {field:'',checkbox:true},
       {field:'userName',title:'用户名',sortable:true},
       {field:'userPassword',title:'密码'},
       {field:'info',title:'信息'},
       {field:'userSex',title:'性别',sortable:true},
       {field:'roleName',title:'角色名'},
       {field:'remarks',title:'角色备注'},
       {field:'createDate',title:'创建时间'}
    ]],
    pagination:true,
    rownumbers:true,
    fitColumns:true,
    toolbar:[{text:'增加用户',handler:addUser},
             {text:'修改用户',handler:editUser},
             {text:'删除用户'}
            ]
  })
  //单击搜索按钮，触发单击事件，根据条件重新加载grid
  $("#search").linkbutton({
  onClick:function(){
      var cb=$("#cc").combobox('getValue');
      var tb=$("#tb").textbox('getValue');
      $("#user").datagrid('load',{
          search:tb,
          searchType:cb
        })
      }
  });
  function addUser(){
	  $('#addUser').window('setTitle','新增用户');
	  $('#addUser').window('open');
  }
  $("#addUser").window({
	  onClose:function(){
	      alert("修改出错");
          }
  });
  function editUser(value,row,index){
	  var selectUser=$('#user').datagrid('getSelections')
	  if(selectUser.length===0){
		  $.messager.alert('编辑用户','请选中一个用户进行编辑');
	  }else if(selectUser.length!==1){
		  $.messager.alert('编辑用户','只能选中一个用户进行编辑');
	  }else{
		  $('#addUser').window('setTitle','编辑用户');
		  $('#addUser').window('open');
		  $('#userInfo').form('load',selectUser[0])
	  }
  }
  function clearForm(){
	  $('#userInfo').form('clear');
	  $('#addUser').window('close');
  }
  function submitForm(){
	  $.messager.progress();
	  $('#userInfo').form('submit',{
		  url:'user/editUser.do',
		  success:function(){
			  $.messager.progress('close');
		      }
	      
	  })
  }
  </script>
</html>
